<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Register</title>
</head>
<body>
<h2>Register</h2>
<form id="registerForm">
    <input type="text" name="firstName" placeholder="First Name" required>
    <input type="text" name="lastName" placeholder="Last Name" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Password" required>
    <button type="submit">Register</button>
</form>
<div id="message"></div>

<script th:inline="javascript">
  const API_BASE = [[${@environment.getProperty('app.paths.api-base')}]];
  const AUTH_BASE = [[${@environment.getProperty('app.paths.auth-base')}]];
  const FRONTEND_BASE = [[${@environment.getProperty('app.paths.frontend-base')}]];

  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    console.log(formData)
    console.log(data)

    try {
      const response = await fetch(`${API_BASE}${AUTH_BASE}/register`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });

    console.log(JSON.stringify(data))

      if (response.ok) {
        document.getElementById('message').innerHTML =
          '<p style="color: green;">Registration successful! Redirecting to login...</p>';
        setTimeout(() => window.location.href = FRONTEND_BASE+"/login", 2000);
      } else {
        const error = await response.json();
        document.getElementById('message').innerHTML =
          `<p style="color: red;">${error.message || 'Registration failed'}</p>`;
      }

    } catch (error) {
      document.getElementById('message').innerHTML =
        '<p style="color: red;">An error occurred. Please try again.</p>';
    }
  });
</script>
</body>
</html>